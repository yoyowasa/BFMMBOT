# configs/live.yml：本番環境で base.yml を必要最小限だけ“上書き”
env: live                  # 何をするか：liveモード指定
product_code: FX_BTC_JPY   # 何をするか：取引銘柄を指定（WS購読とRESTの対象）
tick_size: 1               # 何をするか：価格の最小刻み（JPYは1円）
strategies:
  - stall_then_strike
  - cancel_add_gate
strategies_params:
  stall_then_strike:
    ttl_ms_default: 900
    ttl_ms_overrides:
      - price_band_jpy: [16360000, 16370000]
        ttl_ms: 1500
      - price_band_jpy: [16370000, 16380000]
        ttl_ms: 900
    size_base_btc: 0.005
    size_when_soft_long_btc: 0.0025
    inventory_soft_btc: 0.03
    inventory_hard_btc: 0.05
    spread_multiplier_overrides:
      - price_band_jpy: [16360000, 16370000]
        spread_mult: 1.5
    buy_momentum_gate_bps: 0.2
    min_requote_interval_ms: 300

  cancel_add_gate:
    ttl_ms_default: 900
    ttl_ms_overrides:
      - price_band_jpy: [16340000, 16350000]
        time_window_hhmm: ["22:03", "22:07"]
        ttl_ms: 1500
    block_buy_when_long:
      inv_gt_btc: 0.02
      momentum_bps_gt: 0.2
    cancel_gate:
      queue_eta_s: 1.2
    size_base_btc: 0.006

# 運転時間制御
canary_minutes: 60         # 何をするか：liveを最大60分だけ運転し、超えたら全取消→停止（カナリア）
dry_run_max_sec: 14400     # 何をするか：dry-run時の自動終了秒（14400=4時間）

# モード切替（メンテ／Funding）
mode_switch:
  maintenance:
    start: ""              # 何をするか：メンテ開始(JST)。例 "03:55"（※"24:00"は不可）
    end: ""                # 何をするか：メンテ終了(JST)。例 "04:15"
  funding_calc_jst: []     # 何をするか：Funding計算タイミング(JST)の配列。例 ["08:00:00","16:00:00","00:00:00"]
  funding_transfer_lag_hours: 8   # 何をするか：計算から授受までのラグ時間(時間)。この1時間を“授受窓”として停止

# リスク・ガード
risk:
  max_inventory: 0.1       # 何をするか：建玉の絶対値上限（BTC）
  position_max_age_sec: 900  # 何をするか：非ゼロ在庫の滞留は最長15分に制限。超過時は“強制フラット”動作へ（次ステップで実装）

  max_active_orders: 2     # 何をするか：同時に生きてよい注文の上限
  kill:
    daily_pnl_jpy: -30000  # 何をするか：当日実現PnLがこの額以下なら Kill（全取消→停止）
    max_dd_jpy: -20000     # 何をするか：当日HWMからの落差（DD）がこの額以上なら Kill

guard:
  max_mid_move_bp_30s: 10  # 何をするか：30秒のミッド変化が25bp(0.25%)以上なら“いまは我慢”
  max_stale_ms: 1500       # 何をするか：前回イベントからこのms以上あいたら“いまは我慢”
  max_spread_bp: 5        # 何をするか：スプレッドが10bp(=0.10%)以上なら“いまは我慢”

tx:
  min_interval_ms: 200     # 何をするか：新規注文の最小送信間隔（ms）
  place_dedup_ms: 250      # 何をするか：同じ(side×price×tag)の連打抑止(ms)

size:
  min: 0.001               # 何をするか：最小ロット
  default: 0.001           # 何をするか：戦略がサイズ未指定のときの既定値
  step: 0.001              # 何をするか：サイズ刻み

cancel_all_on_start: true  # 何をするか：起動時に取り残しの注文を全キャンセルしてから運転開始

fees:
  bps: 3.0                 # 何をするか：手数料のベーシスポイント。PnLは実コスト後で記録

logging:
  level: INFO              # 何をするか：ログ詳細度
  heartbeat_status_sec: 5  # 何をするか：心拍（status）出力間隔
  rotate_mb: 128           # 何をするか：run.log をこのサイズ(MB)でローテーション

monitoring:
  inventory_thresholds_btc:
    soft: 0.03
    hard: 0.05
    panic: 0.10
  panic_actions:
    ttl_scale: 1.2
    size_scale: 0.0


